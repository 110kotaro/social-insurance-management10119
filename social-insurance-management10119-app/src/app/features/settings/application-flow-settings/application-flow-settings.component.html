<mat-card>
  <mat-card-header>
    <mat-card-title>
      <mat-icon>description</mat-icon>
      申請フロー設定
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <mat-tab-group [(selectedIndex)]="selectedTabIndex">
      <!-- 申請種別タブ -->
      <mat-tab label="申請種別">
        <ng-template matTabContent>
          <div class="tab-content">
            <div class="action-buttons">
              <button mat-raised-button color="primary" (click)="openApplicationTypeEditDialog(undefined, 'internal')">
                <mat-icon>add</mat-icon>
                内部申請種別を追加
              </button>
            </div>

            <h3>内部申請種別</h3>
            <div class="table-container">
              <table mat-table [dataSource]="internalDataSource" class="application-type-table">
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef>申請種別名</th>
                  <td mat-cell *matCellDef="let type">{{ type.name }}</td>
                </ng-container>

                <ng-container matColumnDef="code">
                  <th mat-header-cell *matHeaderCellDef>コード</th>
                  <td mat-cell *matCellDef="let type">{{ type.code }}</td>
                </ng-container>

                <ng-container matColumnDef="enabled">
                  <th mat-header-cell *matHeaderCellDef>有効</th>
                  <td mat-cell *matCellDef="let type">
                    <mat-icon [color]="type.enabled ? 'primary' : ''">
                      {{ type.enabled ? 'check_circle' : 'cancel' }}
                    </mat-icon>
                  </td>
                </ng-container>

                <ng-container matColumnDef="description">
                  <th mat-header-cell *matHeaderCellDef>説明</th>
                  <td mat-cell *matCellDef="let type">{{ type.description || '-' }}</td>
                </ng-container>

                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>操作</th>
                  <td mat-cell *matCellDef="let type">
                    <button mat-icon-button (click)="openApplicationTypeEditDialog(type)" matTooltip="編集">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button (click)="deleteApplicationType(type)" 
                            [disabled]="!type.isDeletable" 
                            matTooltip="削除" 
                            color="warn">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="internalDisplayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: internalDisplayedColumns;"></tr>
              </table>
            </div>

            <h3>外部申請種別</h3>
            <div class="table-container">
              <table mat-table [dataSource]="externalDataSource" class="application-type-table">
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef>申請種別名</th>
                  <td mat-cell *matCellDef="let type">{{ type.name }}</td>
                </ng-container>

                <!-- コード列は表示しない -->
                <!-- <ng-container matColumnDef="code">
                  <th mat-header-cell *matHeaderCellDef>コード</th>
                  <td mat-cell *matCellDef="let type">{{ type.code }}</td>
                </ng-container> -->

                <ng-container matColumnDef="enabled">
                  <th mat-header-cell *matHeaderCellDef>有効</th>
                  <td mat-cell *matCellDef="let type">
                    <mat-icon [color]="type.enabled ? 'primary' : ''">
                      {{ type.enabled ? 'check_circle' : 'cancel' }}
                    </mat-icon>
                  </td>
                </ng-container>

                <!-- 説明列は表示しない -->
                <!-- <ng-container matColumnDef="description">
                  <th mat-header-cell *matHeaderCellDef>説明</th>
                  <td mat-cell *matCellDef="let type">{{ type.description || '-' }}</td>
                </ng-container> -->

                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>操作</th>
                  <td mat-cell *matCellDef="let type">
                    <button mat-icon-button (click)="openApplicationTypeEditDialog(type)" matTooltip="編集">
                      <mat-icon>edit</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="externalDisplayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: externalDisplayedColumns;"></tr>
              </table>
            </div>
          </div>
        </ng-template>
      </mat-tab>

      <!-- 承認ルールタブ（コメントアウト） -->
      <!-- <mat-tab label="承認ルール">
        <ng-template matTabContent>
          <div class="tab-content">
            <h3>承認ルール</h3>
            <p class="info-text">現在の承認方法: 管理者のいずれか一名の承認（固定）</p>
            
            <mat-form-field appearance="outline">
              <mat-label>説明文</mat-label>
              <textarea matInput [(ngModel)]="approvalRuleDescription" rows="3"></textarea>
              <mat-hint>承認ルールの説明文を入力してください</mat-hint>
            </mat-form-field>

            <div class="button-group">
              <button mat-raised-button color="primary" (click)="saveApplicationFlowSettings()" [disabled]="isLoading">
                <mat-icon>save</mat-icon>
                保存
              </button>
            </div>
          </div>
        </ng-template>
      </mat-tab> -->

      <!-- 添付書類設定タブ -->
      <mat-tab label="添付書類設定">
        <ng-template matTabContent>
          <div class="tab-content">
            <div class="action-buttons">
              <button mat-raised-button color="primary" (click)="openAttachmentSettingEditDialog()">
                <mat-icon>add</mat-icon>
                添付書類設定を追加
              </button>
            </div>

            <div class="table-container">
              <table mat-table [dataSource]="attachmentDataSource" class="attachment-setting-table">
                <ng-container matColumnDef="applicationType">
                  <th mat-header-cell *matHeaderCellDef>申請種別</th>
                  <td mat-cell *matCellDef="let setting">{{ getApplicationTypeName(setting.applicationTypeId) }}</td>
                </ng-container>

                <ng-container matColumnDef="allowedFormats">
                  <th mat-header-cell *matHeaderCellDef>許可ファイル形式</th>
                  <td mat-cell *matCellDef="let setting">
                    {{ formatAllowedFormats(setting.allowedFormats) }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="maxFileSize">
                  <th mat-header-cell *matHeaderCellDef>最大ファイルサイズ</th>
                  <td mat-cell *matCellDef="let setting">{{ formatFileSize(setting.maxFileSize) }}</td>
                </ng-container>

                <ng-container matColumnDef="description">
                  <th mat-header-cell *matHeaderCellDef>説明</th>
                  <td mat-cell *matCellDef="let setting">{{ setting.description || '-' }}</td>
                </ng-container>

                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>操作</th>
                  <td mat-cell *matCellDef="let setting">
                    <button mat-icon-button (click)="openAttachmentSettingEditDialog(setting)" matTooltip="編集">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button (click)="deleteAttachmentSetting(setting)" matTooltip="削除" color="warn">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="attachmentDisplayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: attachmentDisplayedColumns;"></tr>
              </table>
            </div>
          </div>
        </ng-template>
      </mat-tab>
    </mat-tab-group>
  </mat-card-content>
</mat-card>

