<mat-card>
  <mat-card-header>
    <mat-card-title>
      <mat-icon>groups</mat-icon>
      部署設定
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <p class="description">組織の部署を追加・削除できます。</p>
    
    <form [formGroup]="departmentsForm" class="add-department-form">
      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>部署名</mat-label>
          <input matInput formControlName="name" placeholder="営業部" required>
          <mat-error *ngIf="departmentsForm.get('name')?.hasError('required')">
            部署名を入力してください
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>部署コード</mat-label>
          <input matInput formControlName="code" placeholder="SALES">
        </mat-form-field>
      </div>

      <!-- 上位部署フィールド（コメントアウト） -->
      <!-- <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>上位部署（親部署、任意）</mat-label>
          <mat-select formControlName="parentDepartmentId">
            <mat-option [value]="null">なし</mat-option>
            <mat-option *ngFor="let dept of departments" [value]="dept.id">
              {{ dept.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div> -->

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>メールアドレス（任意）</mat-label>
          <input matInput type="email" formControlName="email" placeholder="sales@example.com">
          <mat-error *ngIf="departmentsForm.get('email')?.hasError('email')">
            メールアドレスの形式が正しくありません
          </mat-error>
        </mat-form-field>
      </div>

      <div class="button-group">
        <button mat-raised-button type="button" color="primary" (click)="addDepartment()" [disabled]="departmentsForm.invalid || isSaving">
          <mat-icon>add</mat-icon>
          <span *ngIf="!isSaving">部署を追加</span>
          <span *ngIf="isSaving">追加中...</span>
        </button>
      </div>
    </form>

    <!-- 部署一覧 -->
    <div class="departments-list" *ngIf="departments.length > 0">
      <h3>部署一覧</h3>
      <mat-list>
        <mat-list-item *ngFor="let dept of departments">
          <div class="department-item">
            <div class="department-info">
              <span class="department-name">{{ dept.name }}</span>
              <span class="department-code" *ngIf="dept.code">（{{ dept.code }}）</span>
              <span class="department-email" *ngIf="dept.email">{{ dept.email }}</span>
              <span class="department-parent" *ngIf="dept.parentDepartmentId">
                親部署: {{ getParentDepartmentName(dept.parentDepartmentId) }}
              </span>
            </div>
            <button mat-icon-button color="warn" (click)="removeDepartment(dept.id!)" [disabled]="isLoading">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </mat-list-item>
      </mat-list>
    </div>

    <div *ngIf="departments.length === 0 && !isLoading" class="empty-message">
      部署が登録されていません。上記フォームから部署を追加してください。
    </div>

    <div *ngIf="isLoading" class="loading-message">
      読み込み中...
    </div>
  </mat-card-content>
</mat-card>
